{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="icon" type="image/x-icon" href="/IMAGES/fevicon.png" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Raleway&display=swap"
        rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Raleway:wght@400&display=swap" rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@700&family=Noto+Sans:wght@500&display=swap"
        rel="stylesheet" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,200;0,300;0,400;0,500;0,700;0,800;1,800&display=swap"
        rel="stylesheet" />

    <link href="https://css.gg/notifications.css" rel="stylesheet" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css"
        integrity="sha256-kLaT2GOSpHechhsozzB+flnD+zUyjE2LlfWPgU04xyI=" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"
        integrity="sha256-WBkoXOwTeyKclOHuWtc+i2uENFpDZ9YPdf5Hf+D7ewM=" crossorigin=""></script>
    <script src="https://code.jquery.com/jquery-3.6.3.js"
        integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM=" crossorigin="anonymous"></script>
    <title>Dashboard | NEARBY FACILITIES</title>
</head>
<style>
    *::-webkit-scrollbar {
        display: none;
    }

    input:focus {
        outline: none;
        transition: 0.6s;
    }

    textarea:focus {
        outline: none;
        transition: 0.6s;
    }
</style>

<body class="scroll-smooth bg-[#1e1e2f] overflow-x-hidden" style="font-family: 'Poppins', sans-serif">
    <div class="top-0" id="main">
        <div class="pl-10 pt-5 pr-10 pb-4 border-t-2 top-0 border-pink-500 fixed z-50 bg-[#1e1e2f]">
            <header class="flex flex-row justify-between text-white h-12 w-full pt-7 w-screen pr-28">
                <h1 class="text-md">RENTER DASHBOARD | NEARBY FACILITIES</h1>
                <ul class="flex flex-row">

                    <li class="flex">
                        <div class="icon flex flex-row" style="width: 30px; height: 30px; margin-top: 7px"
                            onclick="not()" id="msg" onmouseover="this.style.cursor = 'pointer'" ;>
                            <img src="{% static 'IMG/msg.png' %}" alt="" class="w-full" /><span style="
                    margin-left: 0px;
                    color: rgb(236, 20, 56);
                    margin-top: -8px;
                    font-weight: bold;
                  "></span>
                        </div>
                    </li>
                    <li class="flex mx-10">
                        <div class="flex flex-row" style="width:30px; height:30px; margin-top:7px" id="nott"
                            onmouseover="this.style.cursor = 'pointer'">
                            <img src="{% static 'IMG/bell.png' %}" alt=""><span
                                style="margin-left: -6px; color:rgb(255, 255, 255); font-size:1.1rem; margin-top:-8px ;font-weight:bold;"
                                id="spn">{{cont}}</span>
                        </div>
                    </li>
                </ul>
            </header>
        </div>

        <div class="flex flex-wrap justify-start relative top-24 h-full mx-4">
            <div class="fixed h-screen">
                <div class="sidebar font-light opacity-100 shadow-sm flex flex-col justify-center w-64 rounded-md m-5 pl-2 pt-5 pr-10 pb-6 text-white"
                    style="
              font-family: 'Poppins', sans-serif;
              height: 90vh;
              background-image: linear-gradient(
                145deg,
                #cc208e 0%,
                #6713d2 100%
              );
            ">
                    <div class="h-fit flex flex-col justify-center">
                        <!-- Profile Overview in short (Logo, Name, House Address) -->
                        <div class="flex border-b relative mt-2 -top-44 ml-2">
                            <img src="{% static 'IMG/white 1.png' %}" alt="" class="w-40 pl-2 pr-2 fill-white" />
                        </div>
                    </div>

                    <!-- All Options -->
                    <div class="flex ml-7 mt-1">
                        <div class="flex flex-col justify-between w-fit h-96 mt-2">
                            <ul class="relative -top-36">
                                <li class="flex">
                                    
                                    <a href="{% url 'dashP' phn=key%}" class="flex">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M9 17.25v1.007a3 3 0 01-.879 2.122L7.5 21h9l-.621-.621A3 3 0 0115 18.257V17.25m6-12V15a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 15V5.25m18 0A2.25 2.25 0 0018.75 3H5.25A2.25 2.25 0 003 5.25m18 0V12a2.25 2.25 0 01-2.25 2.25H5.25A2.25 2.25 0 013 12V5.25" />
                                        </svg>
                                        <h1 class="mt-1 ml-7 tracking-wider" style="font-size: 10.5px">
                                            PROFILE OVERVIEW
                                        </h1>
                                    </a>
                                </li>
                                <li class="mt-11">
                                    <a href="{% url 'rent' phn=key%}" class="flex">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M2.25 18.75a60.07 60.07 0 0115.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 013 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 00-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 01-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 003 15h-.75M15 10.5a3 3 0 11-6 0 3 3 0 016 0zm3 0h.008v.008H18V10.5zm-12 0h.008v.008H6V10.5z" />
                                        </svg>

                                        <h1 class="mt-1 ml-7 tracking-wider" style="font-size: 10.5px">
                                            PAY RENT
                                        </h1>
                                    </a>
                                </li>

                                <li class="mt-11">
                                    <a href="{% url 'complain' phn=key%}" class="flex">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126zM12 15.75h.007v.008H12v-.008z" />
                                        </svg>

                                        <h1 class="mt-1 ml-7 tracking-wider" style="font-size: 10.5px">
                                            NOTE A COMPLAIN
                                        </h1>
                                    </a>
                                </li>

                                <li class="mt-11">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="1.5" stroke="currentColor" class="w-3 h-6 -left-4 absolute">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M8.25 4.5l7.5 7.5-7.5 7.5" />
                                    </svg>
                                    <a href="{% url 'maps' phn=key%}" class="flex">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
                                        </svg>

                                        <h1 class="mt-1 ml-7 tracking-wider" style="font-size: 10.5px">
                                            NEARBY FACILITIES
                                        </h1>
                                    </a>
                                </li>

                                <li class="mt-11">
                                    <a href="{% url 'setting' phn=key%}" class="flex">
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                            stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M10.343 3.94c.09-.542.56-.94 1.11-.94h1.093c.55 0 1.02.398 1.11.94l.149.894c.07.424.384.764.78.93.398.164.855.142 1.205-.108l.737-.527a1.125 1.125 0 011.45.12l.773.774c.39.389.44 1.002.12 1.45l-.527.737c-.25.35-.272.806-.107 1.204.165.397.505.71.93.78l.893.15c.543.09.94.56.94 1.109v1.094c0 .55-.397 1.02-.94 1.11l-.893.149c-.425.07-.765.383-.93.78-.165.398-.143.854.107 1.204l.527.738c.32.447.269 1.06-.12 1.45l-.774.773a1.125 1.125 0 01-1.449.12l-.738-.527c-.35-.25-.806-.272-1.203-.107-.397.165-.71.505-.781.929l-.149.894c-.09.542-.56.94-1.11.94h-1.094c-.55 0-1.019-.398-1.11-.94l-.148-.894c-.071-.424-.384-.764-.781-.93-.398-.164-.854-.142-1.204.108l-.738.527c-.447.32-1.06.269-1.45-.12l-.773-.774a1.125 1.125 0 01-.12-1.45l.527-.737c.25-.35.273-.806.108-1.204-.165-.397-.505-.71-.93-.78l-.894-.15c-.542-.09-.94-.56-.94-1.109v-1.094c0-.55.398-1.02.94-1.11l.894-.149c.424-.07.765-.383.93-.78.165-.398.143-.854-.107-1.204l-.527-.738a1.125 1.125 0 01.12-1.45l.773-.773a1.125 1.125 0 011.45-.12l.737.527c.35.25.807.272 1.204.107.397-.165.71-.505.78-.929l.15-.894z" />
                                            <path stroke-linecap="round" stroke-linejoin="round"
                                                d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                                        </svg>

                                        <h1 class="mt-1 ml-7 tracking-wider" style="font-size: 10.5px">
                                            PROFILE SETTINGS
                                        </h1>
                                    </a>
                                </li>
                            </ul>
                            <ul class="relative top-32">
                                <a href="{% url 'logout' %}" class="flex">
                                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"
                                        stroke-width="1.5" stroke="currentColor" class="w-5 h-6">
                                        <path stroke-linecap="round" stroke-linejoin="round"
                                            d="M15.75 9V5.25A2.25 2.25 0 0013.5 3h-6a2.25 2.25 0 00-2.25 2.25v13.5A2.25 2.25 0 007.5 21h6a2.25 2.25 0 002.25-2.25V15M12 9l-3 3m0 0l3 3m-3-3h12.75" />
                                    </svg>

                                    <h1 class="mt-1 ml-7 tracking-wider" style="font-size: 10.5px">
                                        LOGOUT
                                    </h1>
                                </a>
                            </ul>
                        </div>
                    </div>
                    <!-- Logout -->
                </div>
            </div>

            <!-- MAIN PROFILE OVERVIEW -->
            <div class="ml-80 mr-5 mt-5 p-8 pt-7 bg-[#2b2b41] rounded-xl drop-shadow-2xl w-full pb-4 h-full">
                <div class="grid pl-2 ">
                    <h1 class="text-white mx-4 tracking-wider" style="font-size: 1.1rem;">Your Address Area</h1>
                </div>
                <div class="flex justify-start w-full mx-2 mt-6">
                    <div class=" shadow-2xl bg-[#27273d] border border-[#3d3d5c] rounded-2xl w-1/3 h-full p-6">
                        <h1 class="text-white mx-4 tracking-wider font-extralight text-xl">Current City
                        </h1>

                        <input name="year" id="year"
                            class="bg-[#27273d] border border-[#3d3d5c] rounded-md h-9 w-4/5 relative mx-4 mt-2 text-white p-5 focus:border-[#cc208e] focus:outline-none transition-all"
                            style="font-size: 12px; display: flex;" value="Dhaka" readonly>

                    </div>
                    <div class=" shadow-2xl bg-[#27273d] border border-[#3d3d5c] rounded-2xl w-1/3 h-full p-6 ml-3">
                        <h1 class="text-white mx-4 tracking-wider font-extralight text-xl">Current Area
                        </h1>

                        <input name="year" id="area"
                            class="bg-[#27273d] border border-[#3d3d5c] rounded-md h-9 w-4/5 relative mx-4 mt-2 text-white p-5 focus:border-[#cc208e] focus:outline-none transition-all"
                            style="font-size: 12px; display: flex;" value="Banasree, Rampura" readonly>

                    </div>
                    <div class=" shadow-2xl bg-[#27273d] border border-[#3d3d5c] rounded-2xl w-1/3 h-full p-6 ml-3">
                        <h1 class="text-white mx-4 tracking-wider font-extralight text-xl">Select Categories:
                        </h1>

                        <select name="year_" id="cat_"
                            class="bg-[#27273d] border border-[#3d3d5c] rounded-md h-11 ml-4 mt-2 text-white w-2/3 p-3 focus:border-[#cc208e] focus:outline-none transition-all"
                            style="font-size: 12px; display: flex;">
                            <option value="" selected>Select a category: </option>
                            <option value="school">Schools </option>
                            <option value="hospital">Hospitals </option>
                            <option value="pharmacy">Pharmacy</option>
                            <option value="bank">Banks</option>
                            <option value="restaurant">Restaurants</option>
                        </select>

                    </div>

                </div>

                <div class="map w-full mt-7 rounded-2xl" style="height: 50vh" id="map" >
    
                </div>
            </div>

        </div>
    </div>
    </div>

    <div id="notii"
        style="position:fixed; width: 400px; margin-top:-40%; opacity:0; margin-left:80%; height: 80%; background-color:#2b2b41;  border-radius:10px;">

        {% for n in noti %}
        <div class="text-white flex bg-[#2b2b41] p-4 mt-2 w-full border-b-2" style="height: 70px;">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5"
                stroke="currentColor" class="w-9 h-9 pr-2 text-orange-600">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M11.25 11.25l.041-.02a.75.75 0 011.063.852l-.708 2.836a.75.75 0 001.063.853l.041-.021M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-9-3.75h.008v.008H12V8.25z" />
            </svg>

            <div class="h-full w-full">
                <h1>{{n.notification}}</h1>

            </div>
        </div>
        {%endfor%}




    </div>

    <script>
        var lat, lng, map;
        mpii = document.getElementById("map");
        console.log(document.getElementById("area").value);
        var url = "https://nominatim.openstreetmap.org/search?q=" + encodeURIComponent(document.getElementById("area").value) + "&format=json";
        console.log(url);
        $.ajax({
            url: url,
            dataType: 'json',
            success: function (data) {

                lat = data[0].lat;
                lng = data[0].lon;
                console.log(lat, lng);
                map = L.map(mpii).setView([lat, lng], 16);

                L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    maxZoom: 100,
                    attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
                }).addTo(map);

                $(document).ready(function () {
                    $("#cat_").on("change", function () {
                        var url = 'https://overpass-api.de/api/interpreter?data=[out:json];' +
                            'node(around:' + 500 + ',' + lat + ',' + lng + ');' +
                            'node["amenity"="'+this.value+'"](around:' + 1000 + ',' + lat + ',' + lng + ');' +
                            'out;';
                        //console.log(L.Marker) ;
                        map.eachLayer(function(layer) {
                            if (layer instanceof L.Marker) {
                              map.removeLayer(layer);
                            }
                        });
                        
                        $.ajax({
                            url: url,
                            dataType: 'json',
                            success: function (data) {
                                var element = "" ;
                                for (var i = 0; i < data.elements.length; i++) {
                                    element = data.elements[i];
                                    console.log(element) ;
                                    if (element.tags && element.tags.name) {
                                        var marker = L.marker([element.lat, element.lon])
                                            .bindPopup(element.tags.name)
                                            .addTo(map);
                                    }
                                    
                                }
                            }
                        });
                    });
                });


                // Do something with the coordinates
            }
        });




    </script>
    <script>

        var box = document.getElementById("notii");
        var m = document.getElementById("main");
        var spn = document.getElementById("spn");

        $(document).ready(function () {
            var clk = 1;
            $('#nott').on("click", function () {
                $.ajax({
                    url: "{% url 'noti' phn=key%}",
                    success: function (res) {
                        spn.innerText = res.count;
                        if (clk == 1) {
                            box.style.opacity = 1;
                            clk = 0;
                        } else {
                            box.style.opacity = 0;
                            clk = 1;
                        }
                    },
                })

            });
        })
    </script>
</body>

</html>